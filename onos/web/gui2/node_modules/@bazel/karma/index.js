(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("@bazel/karma", ["require", "exports", "crypto", "fs", "path", "process", "readline", "tmp"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    /*
     * Concat all JS files before serving.
     */
    const crypto = require("crypto");
    const fs = require("fs");
    const path = require("path");
    const process = require("process");
    const readline_1 = require("readline");
    const tmp = require("tmp");
    ///<reference types="lib.dom"/>
    /**
     * Return SHA1 of data buffer.
     */
    function sha1(data) {
        const hash = crypto.createHash('sha1');
        hash.update(data);
        return hash.digest('hex');
    }
    /**
     * Entry-point for the Karma plugin.
     */
    function initConcatJs(logger, emitter, basePath, hostname, port) {
        const log = logger.create('framework.concat_js');
        // Create a tmp file for the concat bundle that is automatically cleaned up on
        // exit.
        const tmpFile = tmp.fileSync({ keep: false, dir: process.env['TEST_TMPDIR'] });
        emitter.on('file_list_modified', files => {
            const bundleFile = {
                path: '/concatjs_bundle.js',
                contentPath: tmpFile.name,
                isUrl: false,
                content: '',
                encodings: {},
            };
            // Preserve all non-JS that were there in the included list.
            const included = files.included.filter(f => path.extname(f.originalPath) !== '.js');
            const bundledFiles = files.included.filter(f => path.extname(f.originalPath) === '.js').map((file) => {
                const relativePath = path.relative(basePath, file.originalPath).replace(/\\/g, '/');
                let content = file.content + `\n//# sourceURL=http://${hostname}:${port}/base/` +
                    relativePath + '\n';
                return `
  loadFile(
      ${JSON.stringify(relativePath)},
      ${JSON.stringify(content)});`;
            });
            // Execute each file by putting it in a <script> tag. This makes them create
            // global variables, even with 'use strict'; (unlike eval).
            bundleFile.content = `
(function() {  // Hide local variables
  // IE 8 and below do not support document.head.
  var parent = document.getElementsByTagName('head')[0] ||
                    document.documentElement;
  function loadFile(path, src) {
    try {
      var script = document.createElement('script');
      if ('textContent' in script) {
        script.textContent = src;
      } else {
        // This is for IE 8 and below.
        script.text = src;
      }
      parent.appendChild(script);
      // Don't pollute the DOM with hundreds of <script> tags.
      parent.removeChild(script);
    } catch(err) {
      window.__karma__ && window.__karma__.error(
          'An error occurred while loading ' + path + ':\\n' +
          (err.stack || err.message || err.toString()));
      console.error('An error occurred while loading ' + path, err);
      throw err;
    }
  }
${bundledFiles.join('')}
})();`;
            bundleFile.sha = sha1(Buffer.from(bundleFile.content));
            bundleFile.mtime = new Date();
            included.unshift(bundleFile);
            files.included = included;
            files.served.push(bundleFile);
            log.debug('Writing concatjs bundle to tmp file %s', bundleFile.contentPath);
            fs.writeFileSync(bundleFile.contentPath, bundleFile.content);
        });
    }
    initConcatJs.$inject =
        ['logger', 'emitter', 'config.basePath', 'config.hostname', 'config.port'];
    function watcher(fileList) {
        // ibazel will write this string after a successful build
        // We don't want to re-trigger tests if the compilation fails, so
        // we should only listen for this event.
        const IBAZEL_NOTIFY_BUILD_SUCCESS = 'IBAZEL_BUILD_COMPLETED SUCCESS';
        // ibazel communicates with us via stdin
        const rl = readline_1.createInterface({ input: process.stdin, terminal: false });
        rl.on('line', (chunk) => {
            if (chunk === IBAZEL_NOTIFY_BUILD_SUCCESS) {
                fileList.refresh();
            }
        });
        rl.on('close', () => {
            // Give ibazel 5s to kill our process, otherwise do it ourselves
            setTimeout(() => {
                console.error('ibazel failed to stop karma after 5s; probably a bug');
                process.exit(1);
            }, 5000);
        });
    }
    watcher.$inject = ['fileList'];
    module.exports = {
        'framework:concat_js': ['factory', initConcatJs],
        'watcher': ['value', watcher],
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9rYXJtYS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztJQUFBOztPQUVHO0lBQ0gsaUNBQWlDO0lBQ2pDLHlCQUF5QjtJQUN6Qiw2QkFBNkI7SUFDN0IsbUNBQW1DO0lBQ25DLHVDQUF5QztJQUN6QywyQkFBMkI7SUFDM0IsK0JBQStCO0lBRS9COztPQUVHO0lBQ0gsU0FBUyxJQUFJLENBQUMsSUFBSTtRQUNoQixNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVMsWUFBWSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxJQUFJO1FBQzdELE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUVqRCw4RUFBOEU7UUFDOUUsUUFBUTtRQUNSLE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUU3RSxPQUFPLENBQUMsRUFBRSxDQUFDLG9CQUFvQixFQUFFLEtBQUssQ0FBQyxFQUFFO1lBQ3ZDLE1BQU0sVUFBVSxHQUFHO2dCQUNqQixJQUFJLEVBQUUscUJBQXFCO2dCQUMzQixXQUFXLEVBQUUsT0FBTyxDQUFDLElBQUk7Z0JBQ3pCLEtBQUssRUFBRSxLQUFLO2dCQUNaLE9BQU8sRUFBRSxFQUFFO2dCQUNYLFNBQVMsRUFBRSxFQUFFO2FB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WUFDbEIsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ1gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUEsT0FBZSxDQUFDLE9BQU8sR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRXhDLE1BQU0sQ0FBQyxPQUFPLEdBQUc7UUFDZixxQkFBcUIsRUFBRSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUM7UUFDaEQsU0FBUyxFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQztLQUM5QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvbmNhdCBhbGwgSlMgZmlsZXMgYmVmb3JlIHNlcnZpbmcuXG4gKi9cbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIHByb2Nlc3MgZnJvbSAncHJvY2Vzcyc7XG5pbXBvcnQge2NyZWF0ZUludGVyZmFjZX0gZnJvbSAncmVhZGxpbmUnO1xuaW1wb3J0ICogYXMgdG1wIGZyb20gJ3RtcCc7XG4vLy88cmVmZXJlbmNlIHR5cGVzPVwibGliLmRvbVwiLz5cblxuLyoqXG4gKiBSZXR1cm4gU0hBMSBvZiBkYXRhIGJ1ZmZlci5cbiAqL1xuZnVuY3Rpb24gc2hhMShkYXRhKSB7XG4gIGNvbnN0IGhhc2ggPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMScpO1xuICBoYXNoLnVwZGF0ZShkYXRhKTtcbiAgcmV0dXJuIGhhc2guZGlnZXN0KCdoZXgnKTtcbn1cblxuLyoqXG4gKiBFbnRyeS1wb2ludCBmb3IgdGhlIEthcm1hIHBsdWdpbi5cbiAqL1xuZnVuY3Rpb24gaW5pdENvbmNhdEpzKGxvZ2dlciwgZW1pdHRlciwgYmFzZVBhdGgsIGhvc3RuYW1lLCBwb3J0KSB7XG4gIGNvbnN0IGxvZyA9IGxvZ2dlci5jcmVhdGUoJ2ZyYW1ld29yay5jb25jYXRfanMnKTtcblxuICAvLyBDcmVhdGUgYSB0bXAgZmlsZSBmb3IgdGhlIGNvbmNhdCBidW5kbGUgdGhhdCBpcyBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgb25cbiAgLy8gZXhpdC5cbiAgY29uc3QgdG1wRmlsZSA9IHRtcC5maWxlU3luYyh7a2VlcDogZmFsc2UsIGRpcjogcHJvY2Vzcy5lbnZbJ1RFU1RfVE1QRElSJ119KTtcblxuICBlbWl0dGVyLm9uKCdmaWxlX2xpc3RfbW9kaWZpZWQnLCBmaWxlcyA9PiB7XG4gICAgY29uc3QgYnVuZGxlRmlsZSA9IHtcbiAgICAgIHBhdGg6ICcvY29uY2F0anNfYnVuZGxlLmpzJyxcbiAgICAgIGNvbnRlbnRQYXRoOiB0bXBGaWxlLm5hbWUsXG4gICAgICBpc1VybDogZmFsc2UsXG4gICAgICBjb250ZW50OiAnJyxcbiAgICAgIGVuY29kaW5nczoge30sXG4gICAgfSBhcyBhbnk7XG4gICAgLy8gUHJlc2VydmUgYWxsIG5vbi1KUyB0aGF0IHdlcmUgdGhlcmUgaW4gdGhlIGluY2x1ZGVkIGxpc3QuXG4gICAgY29uc3QgaW5jbHVkZWQgPSBmaWxlcy5pbmNsdWRlZC5maWx0ZXIoZiA9PiBwYXRoLmV4dG5hbWUoZi5vcmlnaW5hbFBhdGgpICE9PSAnLmpzJyk7XG4gICAgY29uc3QgYnVuZGxlZEZpbGVzID1cbiAgICAgICAgZmlsZXMuaW5jbHVkZWQuZmlsdGVyKGYgPT4gcGF0aC5leHRuYW1lKGYub3JpZ2luYWxQYXRoKSA9PT0gJy5qcycpLm1hcCgoZmlsZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IHBhdGgucmVsYXRpdmUoYmFzZVBhdGgsIGZpbGUub3JpZ2luYWxQYXRoKS5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG5cbiAgICAgICAgICBsZXQgY29udGVudCA9IGZpbGUuY29udGVudCArIGBcXG4vLyMgc291cmNlVVJMPWh0dHA6Ly8ke2hvc3RuYW1lfToke3BvcnR9L2Jhc2UvYCArXG4gICAgICAgICAgICAgIHJlbGF0aXZlUGF0aCArICdcXG4nO1xuXG4gICAgICAgICAgcmV0dXJuIGBcbiAgbG9hZEZpbGUoXG4gICAgICAke0pTT04uc3RyaW5naWZ5KHJlbGF0aXZlUGF0aCl9LFxuICAgICAgJHtKU09OLnN0cmluZ2lmeShjb250ZW50KX0pO2A7XG4gICAgICAgIH0pO1xuXG4gICAgLy8gRXhlY3V0ZSBlYWNoIGZpbGUgYnkgcHV0dGluZyBpdCBpbiBhIDxzY3JpcHQ+IHRhZy4gVGhpcyBtYWtlcyB0aGVtIGNyZWF0ZVxuICAgIC8vIGdsb2JhbCB2YXJpYWJsZXMsIGV2ZW4gd2l0aCAndXNlIHN0cmljdCc7ICh1bmxpa2UgZXZhbCkuXG4gICAgYnVuZGxlRmlsZS5jb250ZW50ID0gYFxuKGZ1bmN0aW9uKCkgeyAgLy8gSGlkZSBsb2NhbCB2YXJpYWJsZXNcbiAgLy8gSUUgOCBhbmQgYmVsb3cgZG8gbm90IHN1cHBvcnQgZG9jdW1lbnQuaGVhZC5cbiAgdmFyIHBhcmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0gfHxcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICBmdW5jdGlvbiBsb2FkRmlsZShwYXRoLCBzcmMpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgaWYgKCd0ZXh0Q29udGVudCcgaW4gc2NyaXB0KSB7XG4gICAgICAgIHNjcmlwdC50ZXh0Q29udGVudCA9IHNyYztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRoaXMgaXMgZm9yIElFIDggYW5kIGJlbG93LlxuICAgICAgICBzY3JpcHQudGV4dCA9IHNyYztcbiAgICAgIH1cbiAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICAgICAgLy8gRG9uJ3QgcG9sbHV0ZSB0aGUgRE9NIHdpdGggaHVuZHJlZHMgb2YgPHNjcmlwdD4gdGFncy5cbiAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChzY3JpcHQpO1xuICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICB3aW5kb3cuX19rYXJtYV9fICYmIHdpbmRvdy5fX2thcm1hX18uZXJyb3IoXG4gICAgICAgICAgJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIGxvYWRpbmcgJyArIHBhdGggKyAnOlxcXFxuJyArXG4gICAgICAgICAgKGVyci5zdGFjayB8fCBlcnIubWVzc2FnZSB8fCBlcnIudG9TdHJpbmcoKSkpO1xuICAgICAgY29uc29sZS5lcnJvcignQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgbG9hZGluZyAnICsgcGF0aCwgZXJyKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cbiR7YnVuZGxlZEZpbGVzLmpvaW4oJycpfVxufSkoKTtgO1xuICAgIGJ1bmRsZUZpbGUuc2hhID0gc2hhMShCdWZmZXIuZnJvbShidW5kbGVGaWxlLmNvbnRlbnQpKTtcbiAgICBidW5kbGVGaWxlLm10aW1lID0gbmV3IERhdGUoKTtcbiAgICBpbmNsdWRlZC51bnNoaWZ0KGJ1bmRsZUZpbGUpO1xuXG4gICAgZmlsZXMuaW5jbHVkZWQgPSBpbmNsdWRlZDtcbiAgICBmaWxlcy5zZXJ2ZWQucHVzaChidW5kbGVGaWxlKTtcblxuICAgIGxvZy5kZWJ1ZygnV3JpdGluZyBjb25jYXRqcyBidW5kbGUgdG8gdG1wIGZpbGUgJXMnLCBidW5kbGVGaWxlLmNvbnRlbnRQYXRoKTtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGJ1bmRsZUZpbGUuY29udGVudFBhdGgsIGJ1bmRsZUZpbGUuY29udGVudCk7XG4gIH0pO1xufVxuXG4oaW5pdENvbmNhdEpzIGFzIGFueSkuJGluamVjdCA9XG4gICAgWydsb2dnZXInLCAnZW1pdHRlcicsICdjb25maWcuYmFzZVBhdGgnLCAnY29uZmlnLmhvc3RuYW1lJywgJ2NvbmZpZy5wb3J0J107XG5cbmZ1bmN0aW9uIHdhdGNoZXIoZmlsZUxpc3Q6IHtyZWZyZXNoOiAoKSA9PiB2b2lkfSkge1xuICAvLyBpYmF6ZWwgd2lsbCB3cml0ZSB0aGlzIHN0cmluZyBhZnRlciBhIHN1Y2Nlc3NmdWwgYnVpbGRcbiAgLy8gV2UgZG9uJ3Qgd2FudCB0byByZS10cmlnZ2VyIHRlc3RzIGlmIHRoZSBjb21waWxhdGlvbiBmYWlscywgc29cbiAgLy8gd2Ugc2hvdWxkIG9ubHkgbGlzdGVuIGZvciB0aGlzIGV2ZW50LlxuICBjb25zdCBJQkFaRUxfTk9USUZZX0JVSUxEX1NVQ0NFU1MgPSAnSUJBWkVMX0JVSUxEX0NPTVBMRVRFRCBTVUNDRVNTJztcbiAgLy8gaWJhemVsIGNvbW11bmljYXRlcyB3aXRoIHVzIHZpYSBzdGRpblxuICBjb25zdCBybCA9IGNyZWF0ZUludGVyZmFjZSh7aW5wdXQ6IHByb2Nlc3Muc3RkaW4sIHRlcm1pbmFsOiBmYWxzZX0pO1xuICBybC5vbignbGluZScsIChjaHVuazogc3RyaW5nKSA9PiB7XG4gICAgaWYgKGNodW5rID09PSBJQkFaRUxfTk9USUZZX0JVSUxEX1NVQ0NFU1MpIHtcbiAgICAgIGZpbGVMaXN0LnJlZnJlc2goKTtcbiAgICB9XG4gIH0pO1xuICBybC5vbignY2xvc2UnLCAoKSA9PiB7XG4gICAgLy8gR2l2ZSBpYmF6ZWwgNXMgdG8ga2lsbCBvdXIgcHJvY2Vzcywgb3RoZXJ3aXNlIGRvIGl0IG91cnNlbHZlc1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignaWJhemVsIGZhaWxlZCB0byBzdG9wIGthcm1hIGFmdGVyIDVzOyBwcm9iYWJseSBhIGJ1ZycpO1xuICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgIH0sIDUwMDApO1xuICB9KTtcbn1cblxuKHdhdGNoZXIgYXMgYW55KS4kaW5qZWN0ID0gWydmaWxlTGlzdCddO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgJ2ZyYW1ld29yazpjb25jYXRfanMnOiBbJ2ZhY3RvcnknLCBpbml0Q29uY2F0SnNdLFxuICAnd2F0Y2hlcic6IFsndmFsdWUnLCB3YXRjaGVyXSxcbn07XG4iXX0=